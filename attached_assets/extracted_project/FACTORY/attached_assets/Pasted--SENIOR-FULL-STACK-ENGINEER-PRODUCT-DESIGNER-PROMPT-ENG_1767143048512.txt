ТЫ — SENIOR FULL-STACK ENGINEER + PRODUCT DESIGNER + PROMPT ENGINEER.
НУЖНО: переработать и довести до идеала раздел приложения “Скрипт” (Shorts Factory), чтобы генерация сценариев была вирусной/трендовой и полностью связанной между модулями, а результат выглядел каждый раз уникально, но предсказуемо качественно.

# 0) Контекст и цель
Приложение уже имеет страницу “Скрипт” со следующими элементами:
- Настройки: Длительность (30/45/60), Стиль скрипта, Стиль голоса (сейчас бесполезен), Язык (на русской версии почему-то дефолт English)
- Конвейер производства (4/4): Хук, Расшифровка/текст, Таймлайн, etc.

ЦЕЛЬ: 
1) Добавить генерацию:
   - YouTube SEO Title (с учетом темы + ключевых слов)
   - 10 Hashtags (8 по теме + 2 суперпопулярных для продвижения)
2) Переработать настройки:
   - Длительность: 30 / 45 / 60 секунд + добавить 2 минуты (120 сек)
   - Стиль голоса УДАЛИТЬ → вместо него модуль “Акцент” (влияет на все тексты)
   - Язык: на RU версии дефолт должен быть “Русский” (обязательно перепроверить)
3) Сделать генерацию связанной:
   - Все модули используют один общий “ScriptContext” и общие “constraints”
   - Можно редактировать промежуточный результат и “достраивать” следующие модули без потери консистентности
   - Можно делать частичную регенерацию (например только хук, только таймлайн, только субтитры), сохраняя остальное
4) Таймлайн — “изюминка”:
   - Новый дизайн: как видеомонтажный timeline (сегменты, сцены, timecode, слои: VO, On-screen text, B-roll/визуал)
   - В мобильной версии выглядит так же круто и читабельно
   - Каждая сцена имеет превью-картинку (миниатюра): либо генерация, либо поиск в интернете (сейчас превью не работают — проверить и починить)
5) Экспорт субтитров с таймкодами:
   - SRT, VTT
   - И “Premiere/DaVinci friendly”: 
     - CSV/TSV (start/end/text) + опционально FCPXML (если реально)
   - Субтитры должны соответствовать таймлайну и длительности

# 1) Главные продуктовые требования (Acceptance Criteria)
A. Длительность влияет на:
- длину хуков, VO, сцен, количество сцен, плотность текста, длину субтитров
- итоговая суммарная длительность таймлайна должна ≈ выбранной (допуск ± 5%)
B. Стиль скрипта влияет на:
- тон, структуру, темп, клише, юмор/серьезность, тип подачи
C. Акцент влияет на:
- формулировки, лексику, “манеру” подачи (официально/военно/мемно и т.п.), но НЕ ломает смысл
D. Результаты уникальны:
- при одной теме выдача не повторяет одинаковые фразы/структуры дословно (использовать вариативность, seed, синонимы, альтернативные ходы)
E. Тексты “красивые”:
- Расшифровка отображает: Спикер, перебивки, ремарки (коротко), визуальные подсказки
F. Таймлайн:
- сцены с точными timecodes, VO, on-screen text, visual prompt/описание кадра, SFX/Music hint (коротко)
- превью работает (пусть даже в MVP через стабильный placeholder + очередь генерации)
G. Субтитры:
- совпадают по смыслу/фразам с VO и сценами
- корректные таймкоды
H. RU версия:
- по умолчанию язык “Русский”
- UI лейблы и результат на русском при RU

# 2) Архитектура данных: единый ScriptContext
Создать единый объект состояния (в БД/сторе):
ScriptContext {
  id,
  topic,              // тема
  niche,              // область/ниша (опционально)
  goal,               // цель: обучить/развлечь/продать/новость/хайп и т.п.
  targetAudience,     // ЦА: возраст/интересы/уровень знаний
  platform,           // YT Shorts / Reels / TikTok
  language,           // ru/en/...
  durationSec,        // 30/45/60/120
  scriptStyleId,      // выбранный стиль
  accentId,           // выбранный акцент
  keywords[],         // ключевые слова для SEO (ввод пользователя)
  bannedWords[],      // опционально, чтобы избегать
  constraints {       // вычисляемые ограничения под длительность
    targetWpm,
    maxWordsVO,
    sceneCountRange,
    hookMaxWords,
    onScreenTextMaxCharsPerScene
  },
  outputs {
    seoTitle,
    hashtags[],
    hook,
    transcriptRich,   // красиво размеченная расшифровка (структурированная)
    timeline { scenes[] },
    subtitles { srt, vtt, csv, tsv, optionalFcpXml }
  },
  edits {            // хранить правки пользователя
    hookUserEdit,
    transcriptUserEdit,
    timelineUserEdit
  },
  generationMeta {
    seed,
    model,
    temperature,
    createdAt,
    updatedAt,
    version
  }
}

# 3) Настройки (UI + логика)
3.1 Длительность:
- варианты: 30 / 45 / 60 / 120 секунд
- при смене длительности показывать предупреждение: “Пересчитать таймлайн/субтитры?” 
  - default: пересчитать downstream (таймлайн + субтитры), НЕ перегенерить тему/стиль.
3.2 Стиль скрипта:
- выпадающий список + короткое описание каждого стиля (tooltip)
- стиль влияет на структуру хуков/подачу/кульминацию/финальный CTA
3.3 Акцент (новый модуль вместо “Стиль голоса”):
- выпадающий список
- default: “Классический”
- 6 популярных + 2 бонусных со звездочкой (мем/тренд)
3.4 Язык:
- если RU версия приложения: default “Русский”
- обязательно тест: новый пользователь → открыть “Скрипт” → язык должен быть RU

# 4) Стили скрипта (проработанный список)
Сделать библиотеку ScriptStyle (id, name, intent, structure, do/dont, templateHints).
Минимальный набор (добавь и реализуй полностью):

1) Новостной (Breaking/Новости)
- Подача: факт → контекст → последствия → “что дальше”
- Структура: ударный хук (1 фраза) + 3 факта + 1 вывод
- Запрет: вода, длинные вступления

2) Криминал (True Crime)
- Подача: загадка/улика → версия → поворот → морал/финал
- Беречь: не романтизировать насилие, без инструкций незаконного

3) Детектив
- Подача: “есть улика” → “подозреваемые” → “поворот” → “развязка”
- Стиль: интрига, короткие фразы, паузы

4) Сторителлинг (личная история/кейс)
- “Я думал… потом случилось… вот что понял…”
- Эмоциональные маркеры, но без лишней лирики

5) Комедия
- Сетап → панч → эскалация → панч-финал
- Больше контрастов и бытовых примеров

6) Классический (универсальный)
- Хук → 3 пункта → микро-итог → CTA

7) Тарантино (стилизация)
- Диалоговость, сарказм, “сцены”
- Резкие переходы, но понятный сюжет
(Важно: это стилизация, без копирования оригинальных текстов)

8) Манга/Аниме
- “внутренний монолог”, драматические ставки, гиперболы
- Сцены как панели: “кадр 1/2/3”

9) Брейнрот (тренд/хаос/fast-cut)
- Очень быстрый темп, нарезка мыслей, простые слова
- Много “резких смен”, короткие строки

10) 18+ с изюминкой (без порнографии)
- Флирт/пикантность на уровне намеков, юмор
- Запрет: откровенная сексуальная детализация, запрещенный контент

+ Добавь еще 6–10 актуальных для Shorts/Reels/TikTok:
11) Трендовый “How-to за 60 секунд”
12) Мифы и факты (Mythbusting)
13) Топ-5/Рейтинг
14) “Red flags / Hot takes”
15) “POV/Ситуация”
16) Режиссерский/Кинематографичный (под монтаж)
17) Научпоп (упрощенно)
18) Мотивационный (без инфоцыганщины)
19) “Сравнение/VS”
20) “История одной ошибки”

Каждый стиль должен иметь:
- Темп (низкий/средний/высокий)
- Тип хуков (вопрос/обещание/шок-факт/конфликт)
- Любимый формат CTA (подписка/вопрос/“сохрани”/“напиши в комменты”)
- Пример микро-структуры (без конкретной темы)

# 5) Акценты (вместо “Стиль голоса”)
Accent library (id, name, description, lexicalHints).
Должно быть:
1) Классический (default) — нейтрально, четко
2) Официально-новостной — сухо, формально, “сообщается…”
3) Военный-официальный — кратко, приказно-канцелярит, “задача/обстановка”
4) Дружеский блогер — просто, “как другу”, немного разговорно
5) Мемный — легкие мемные обороты (без кринжа), коротко
6) Драматический — паузы, напряжение
+ 2 бонусных со звездочкой:
7) *Ироничный “комментатор” — сарказм, “ну конечно…”
8) *“Чат-стример” — живо, реакциями, но не клоунада

Акцент применяется ко всем модулям: hook, transcript, on-screen text, CTA.

# 6) Генерация: модули и порядок (Pipeline)
Создать конвейер генерации (4/4), но логически связанный:

Шаг 0: Normalize input
- topic, keywords, platform, durationSec, style, accent, language
- вычислить constraints (см. ниже)

Шаг 1: SEO пакет
- YouTube Title (SEO)
- 10 hashtags

Шаг 2: Hook
- 1–2 строки, максимально цепко, стиль+акцент+ниша
- без воды

Шаг 3: TranscriptRich (красиво размеченная расшифровка)
Формат (структура):
[СПИКЕР]: текст...
[ПЕРЕБИВКА]: кратко что в кадре (1 строка)
[ТЕКСТ НА ЭКРАНЕ]: коротко (до N символов)
[ПАУЗА/РИТМ]: (опционально) “0.3с пауза”

Шаг 4: Timeline (монтажный)
timeline.scenes[]:
- sceneId
- startTime, endTime
- voText
- onScreenText (коротко)
- visualDescription (что показать)
- shotType (CU/MS/WS), motion (пан/зум/тряска)
- brollKeywords (для поиска/генерации)
- previewImageUrl (может быть null в моменте)
- sfxMusicHint (коротко)

Шаг 5: Subtitles export
- Сгенерировать subtitles из voText/таймкодов сцен
- SRT, VTT, CSV/TSV (start,end,text)
- Если реально: FCPXML captions

# 7) Контроль длительности (важно)
Создать функцию расчета ограничений под длительность.
Принять среднюю скорость речи:
- RU: 135–155 wpm (слова в минуту)
- EN: 150–170 wpm
Вычислить:
- maxWordsVO = durationMin * targetWpm (durationSec/60 * wpm)
- hookMaxWords: 
  - 30с: 12–18 слов
  - 45с: 14–22
  - 60с: 18–28
  - 120с: 25–40
- sceneCountRange:
  - 30с: 5–7 сцен
  - 45с: 7–9
  - 60с: 8–11
  - 120с: 12–18
- onScreenTextMaxCharsPerScene:
  - мобилка: 18–26 символов на строку, максимум 2 строки

Проверка: суммарное (endTime последней сцены) должно быть близко к durationSec.

# 8) Уникальность без потери качества
Сделать систему “вариативности”:
- seed хранить в ScriptContext
- при regenerate: либо новый seed, либо “сохранить стиль, изменить ходы”
- список запрещенных повторов: одинаковые хуки/вступления
- использовать “вариативные шаблоны” (не один промпт, а 3–5 альтернатив на модуль)
- обязательная проверка: если совпадение N-грамм выше порога с прошлым результатом → перегенерить автоматически

# 9) Prompt Templates (ключевое)
Нельзя просто “напиши сценарий” — нужны типовые шаблоны.
Сделай prompt-библиотеку с переменными:
- {topic}, {keywords}, {durationSec}, {style}, {accent}, {audience}, {platform}, {constraints}

Для каждого модуля — отдельный промпт:
A) SEO Title prompt
- требования: 45–70 символов (RU), ключ в начале, без кликбейта-мусора, но вирусно
- 3 варианта + выбрать лучший по правилам

B) Hashtags prompt
- 10 штук: 8 по теме/нишевые + 2 широких/популярных
- без запрещенных, без мусора

C) Hook prompt
- 3 варианта хуков, выбрать лучший
- стиль/акцент обязательны
- при необходимости: “не повторять слова из прошлого hook”

D) TranscriptRich prompt
- строго по структуре [СПИКЕР]/[ПЕРЕБИВКА]/[ТЕКСТ НА ЭКРАНЕ]
- текст должен соответствовать maxWordsVO и сценам
- включить CTA в финале (под стиль)

E) Timeline prompt
- преобразовать transcript в сцены с таймкодами
- каждый сегмент 2–6 секунд (в зависимости от длительности)
- short-form монтаж: быстрые перебивки, ясный смысл

F) Subtitles prompt/генерация
- subtitles берутся из voText и таймкодов
- авто-разбиение строк под мобилку, без длинных строк

# 10) UI/UX: как должно выглядеть (особенно Таймлайн)
10.1 Общий вид раздела “Скрипт”
- Сверху: настройки (duration, style, accent, language, platform)
- Далее: блоки результата (SEO пакет, Хук, Расшифровка, Таймлайн, Субтитры)
- У каждого блока:
  - кнопка “Сгенерировать”
  - кнопка “Регенерировать” (с выбором: новый seed / сохранить смысл)
  - кнопка “Редактировать”
  - кнопка “Применить правки” (обновляет downstream)

10.2 Таймлайн (новый дизайн)
- Визуально как монтажная линия:
  - горизонтальная шкала времени
  - карточки сцен с таймкодом
  - 3 слоя (строки):
    1) VO (закадровый)
    2) On-screen text
    3) Visual/B-roll (описание + превью)
- На мобилке: вертикальный режим “Scene cards”:
  - каждая сцена карточкой: [00:12–00:16], превью слева, VO справа, ниже text overlay
  - свайп между сценами
- Внутри сцены:
  - превью (мини)
  - кнопка “обновить превью”
  - кнопка “копировать текст на экран”
  - кнопка “копировать VO”

10.3 Превью
MVP:
- Если генерация изображений есть: генерить по visualDescription (мини 256–512px)
- Если через поиск: искать по brollKeywords → брать 1 релевантную картинку → кешировать
- Если не удалось: placeholder + статус “в обработке”
Обязательно: сейчас превью “не работают” — найти причину и исправить. 
Сделать логирование ошибок (status, provider, rate limit).

# 11) Экспорт субтитров
Сделать кнопки:
- Скачать SRT
- Скачать VTT
- Скачать CSV (start,end,text)
- Скачать TSV
- (Опционально) Скачать FCPXML captions
Субтитры должны быть совместимы с Premiere и DaVinci:
- таймформат: HH:MM:SS,mmm для SRT
- VTT с точками HH:MM:SS.mmm
- CSV/TSV: start,end,text

# 12) Тест-план (обязательный)
- Тест на каждую длительность: 30/45/60/120 → проверка суммарного тайминга
- Тест на каждый стиль: минимум 5 стилей прогнать и убедиться, что реально отличаются
- Тест на каждый акцент: 3 текста, проверить лексические маркеры
- Тест RU default language
- Тест редактирования: изменить hook → пересобрать transcript/timeline/subtitles без потери смысла
- Тест превью: генерация/поиск → показывается миниатюра, кеш работает

# 13) Ограничения качества (Quality Guardrails)
- запрет “воды” во вступлении
- запрет клише типа “в этом видео мы поговорим”
- обязательный темп: короткие предложения
- обязательная ясность: 1 ключевая мысль + 1 поворот
- финал: CTA в стиле платформы (сохранить/комменты/подписка)

# 14) Реализация
Сделай это как модульный код, чтобы каждый шаг pipeline был отдельной функцией, и можно было включать/выключать шаги.
Сохраняй ScriptContext в storage.
Сделай аккуратный UI (плоский, светлый) под веб и мобилку.

РЕЗУЛЬТАТ: после внедрения я должен открыть “Скрипт”, выбрать тему, стиль, акцент и длительность — и получить полный пакет:
- SEO заголовок (3 варианта + выбранный лучший)
- 10 хештегов
- Хук
- Красивую расшифровку (спикер/перебивки/текст на экране)
- Таймлайн как видеомонтаж
- Превью для сцен
- Экспорт субтитров (SRT/VTT/CSV/TSV)

ВАЖНО: все тексты должны учитывать Style + Accent + Duration и быть связанными между собой.