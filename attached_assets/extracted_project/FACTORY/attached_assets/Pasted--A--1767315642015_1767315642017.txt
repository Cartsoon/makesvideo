ДОПОЛНЕНИЕ / ПРАВКИ К ТЗ “ИСТОЧНИКИ + ТРЕНДЫ” (ОБЯЗАТЕЛЬНО)

# A) Анти-копипаст заголовков (главное правило)
Запрещено:
- копировать заголовки из источников 1-в-1 в наши YouTube Titles/Hook.
- делать очевидный рерайт в стиле "подставил синонимы".

Разрешено и нужно:
- использовать заголовок источника как PROMPT-SIGNAL (что сейчас цепляет аудиторию).
- использовать описание/контент/сниппет статьи как CONTEXT (о чем там реально речь, факты, детали).
- итоговый заголовок генерировать НОВЫЙ: другой порядок, другая формулировка, другой угол, но сохранять смысл и SEO-ключи.

Реализация:
1) На этапе Topic Builder формируем объект TrendTopic:
   TrendTopic {
     seedTitles[]  // заголовки из источников (как сигнал)
     contextSnippets[] // описание/лиды/первые абзацы/описание видео (как контекст)
     entities[]    // имена/объекты/цифры, если есть
     keywords[]    // ключи/теги
     angles[]      // вычисленные углы подачи
   }

2) При генерации SEO Title / Hook / Script передавать:
   - seedTitles (как идеи формулировок/паттернов)
   - contextSnippets (как фактическую основу)
   - запрет "не использовать дословные фразы из seedTitles"

3) Добавить авто-проверку на копирование:
   - similarity check между candidateTitle и seedTitles:
     - если совпадение по 4-граммам/триграммам выше порога → перегенерировать
   - запрет совпадения первых N слов с любым seedTitle
   - хранить fingerprint результата, чтобы не повторять в будущем

# B) Источников всегда 20–30 — без подсветки “недостаточно”
Никаких сообщений “недостаточно источников”.
Система обязана сама обеспечивать норму: 20–30 РАБОЧИХ источников на категорию.

Требование:
- Для каждой категории targetSources = 25 (минимум 20, максимум 30).
- Если рабочие < 20 → автоматически:
  1) отключить (disable) dead источники
  2) добавить новые (auto-discovery)
  3) прогнать health-check
  4) довести до 20–30 OK

UI:
- Можно показывать только список источников и их статусы,
  но НЕ выводить пользователю “мало источников” — пользователь не должен это чинить вручную.

# C) “Источники сам проверь и добавь” — как это должно работать в коде
Нужно сделать 3 уровня обеспечения качества:

C1) Seed pack (стартовый набор)
- В поставке должен быть sources.seed.json.
- Он должен содержать 30 источников на категорию (с запасом), потому что часть со временем отвалится.
- При первом запуске система прогоняет health-check и оставляет только рабочие.

C2) HealthCheckService (автоматическая проверка)
- При добавлении источника: check доступности, валидности RSS/парсинга, проверка дат.
- Плановый крон: каждые 6–12 часов
- Метрики health: status ok/warn/dead, freshnessHours, failuresCount, lastSuccessAt

C3) AutoDiscoveryService (автодобор источников)
Когда okSources < 20:
- автоматически искать и добавлять новые источники:
  - RSS discovery по известным каталогам/поиску (через поисковый API или заранее подготовленные списки)
  - для YouTube: добирать каналы по категории (channel list) + channel RSS feeds
  - fallback: html parsing (если RSS нет)

Важно:
- AutoDiscoveryService добавляет кандидатов в статус “pending”
- прогоняет health-check
- лучшие (по freshness + latency + стабильность) включаются enabled, пока не будет 20–30 OK

Скоринг источников:
score = freshnessWeight + stabilityWeight + domainTrustWeight + diversityWeight
- diversityWeight: чтобы не было 20 источников с одного домена/группы

# D) YouTube Shorts Trends: заголовок как сигнал, описание как контекст
Для YouTube/Shorts items хранить:
- title (signal)
- description (context)
- tags (если есть)
- duration, views, publishedAt (если API доступно)

TrendSignal строить так:
- hookPatterns извлекать из title (структура/тип), но НЕ переносить текст
- angles и факты брать из description/contextSnippets

В prompts для Скрипта:
- "seedTitles: использовать как вдохновение по структуре"
- "contextSnippets: использовать как основу смысла"
- "не цитировать и не перефразировать дословно seedTitles"

# E) Обновление prompts генерации (обязательное)
Во всех prompt’ах для SEO Title/Hook добавить:
- INPUT: seedTitles + contextSnippets
- RULE: "не использовать дословные фразы из seedTitles"
- CHECK: similarity gate → regen

Пример правила (встроить в промпт):
“Запрещено: повторять фразы из seedTitles. Используй их только как пример хода/паттерна. Смысл бери из contextSnippets.”

# F) Deliverables
- sources.seed.json: 30 на категорию (с запасом) + тип (rss/api/html/youtube_channel)
- HealthCheckService + AutoDiscoveryService
- Title/Hook anti-copy gate
- TrendTopic/TrendSignal pipeline: title=signal, content=context
- Интеграция с Topics и Script: Script получает TrendTopic (seedTitles + contextSnippets)