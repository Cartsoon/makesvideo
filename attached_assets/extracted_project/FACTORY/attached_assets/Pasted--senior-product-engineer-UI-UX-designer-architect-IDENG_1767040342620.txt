Ты — senior product engineer + UI/UX designer + architect. Сделай с нуля приложение “IDENGINE: Shorts Factory” — конвейер для производства Shorts/Reels/TikTok из источников (Telegram/RSS/URL/Manual) с генерацией: Тренды → Тема → Сценарий → Раскадровка → Озвучка → Музыка → Экспорт “пакета”.

Ключевая цель: максимально простое и стабильное приложение, без тяжёлых локальных нейросетей. Генерация — через внешние API, но обязательно должен быть fallback режим (работает без ключей и без API).

Приложение должно работать:

как обычный веб-сайт в браузере,

как мобильное приложение через PWA (установка на Android/iOS “на главный экран”),

и выглядеть/вести себя как “app” (touch-friendly, offline-friendly для просмотренных данных).

A) ПРОДУКТ И ФУНКЦИОНАЛ
A1) Основные сущности (БД)

Используй SQLite.

Таблица Source

id (int)

type: telegram | rss | url | manual

name

config_json (JSON)

is_enabled (bool)

created_at

Таблица Topic

id

source_id

title

url (nullable)

raw_text (nullable)

language (default ru)

score (float/int)

status: new | selected | ignored

created_at

Таблица Script

Один “production package” на тему.

id

topic_id

language (ru/en, default ru)

duration_sec (int: 30/45/60)

style_preset (string enum)

voice_style_preset (string enum, может совпадать со style_preset)

hook (text)

voice_text (text)

on_screen_text (text или json) — текст на экране/субтитры

storyboard_json (JSON массив сцен)

music_json (JSON: mood/bpm/ref/link/license)

assets_json (JSON: ссылки на файлы, сгенерированные данные)

status: draft | generating | ready | approved | exported | error

error (text nullable)

created_at, updated_at

Таблица Job

Фоновая задача, чтобы не падало всё приложение.

id

kind: fetch_topics | generate_hook | generate_script | generate_storyboard | generate_voice | pick_music | export_package

payload_json

status: queued | running | done | error

progress (0..100)

error

created_at, updated_at

Таблица Settings

key, value (string)

хранить: API ключи/модель/дефолтные настройки (или через .env + UI)

A2) Стиль/длительность — обязательные параметры

Длительность: пользователь выбирает 30 / 45 / 60 сек везде, где есть генерация (в Script).
Пресеты стиля сценария (обязательно):

Кинематографичный

Режиссерский

Мемный

Трендовый

Классический

Новостной

Пресеты стиля озвучки (обязательно, может быть отдельный выбор):

те же самые 6 вариантов (по умолчанию равен стилю сценария)

Каждый пресет должен влиять на:

тон и лексику

структуру (темп, паузы, длина предложений)

особенности (мемный — сленг/ирония; новостной — нейтрально и фактологично; режиссерский — постановочные ремарки и визуальные акценты)

A3) Пайплайн (поэтапно и “всё сразу”)

На странице Script должны быть отдельные кнопки:

Сгенерировать Hook

Сгенерировать Сценарий

Сгенерировать Раскадровку

Сгенерировать Озвучку

Подобрать Музыку

Экспортировать пакет

Сгенерировать всё (запускает цепочку jobs по порядку)

Каждый этап:

не ломает приложение

пишет статус/ошибку в Script и/или Job

показывает прогресс и лог (минимальный)

A4) Источники/тренды
/sources

список источников, добавить/редактировать/удалить, toggle enabled

типы:

RSS: url

Telegram: на первом этапе через RSSHub ссылку (или просто url на канал + подсказка как получить RSSHub). Не делай сложную авторизацию.

URL: ручное добавление ссылки + заголовка

Manual: ручной ввод текста “что обсуждают/о чем тема”

/topics

кнопка “Обновить темы” → Job fetch_topics

список тем (new/selected/ignored) фильтры

сортировки: score desc, date desc

действия: Select → создаёт Script; Ignore → status ignored

Scoring:

простой: длина, наличие ключевых слов, источники приоритетов, повторяемость

без ML

A5) Генерации через API + fallback (обязательная архитектура провайдеров)

Сделай провайдеры:

LLMProvider

TTSProvider

MusicProvider

LLM

основной: OpenRouter (API key в Settings/.env)

модель выбирается в Settings (по умолчанию какая-нибудь доступная)

функции:

generate_hook(topic, preset, duration)

generate_script(topic, preset, duration)

generate_storyboard(script, preset, duration)

optional: generate_hashtags(topic)

TTS

опционально через внешний сервис (подключаемый)

если ключей нет: генерим “voice.txt” вместо аудио

Music

на первом этапе можно “suggestions”: mood/bpm/жанр/референсы + ссылки на бесплатные библиотеки

в будущем можно заменить на реальный API

Fallback режим (ОБЯЗАТЕЛЬНО)

Если нет ключей/ошибка API:

hook: шаблон из 1–2 строк

voice_text: шаблон из структуры 30/45/60

storyboard: 6–10 сцен с заполненными полями

музыка: suggestions json

экспорт: всегда работает (zip)

A6) Экспорт “полного пакета” (ZIP)

Кнопка “Скачать пакет” → генерировать ZIP:

hook.txt

voiceover.txt (voice_text)

onscreen.txt (on_screen_text)

storyboard.json

storyboard.md (читабельно)

music.json

voice.mp3/wav (если есть)

meta.json (id, тема, источник, стиль, длительность, дата)

README.md (как использовать в монтаже: порядок, тайминг, рекомендации)

B) ДИЗАЙН-ТЗ (WEB + MOBILE APP / PWA)
B1) Форм-фактор и UX

Нужно приложение “как мобильное”:

touch targets >= 44px

без мелких ссылок

sticky bottom navigation на мобильном

быстрые действия на карточках

все основные экраны доступны 1–2 тапа

Должно работать как:

Desktop Web

Mobile Web

PWA installed (standalone mode)

B2) PWA требования (обязательно)

manifest.json с именем, иконками, theme_color, background_color

Service Worker: кэш статики + offline page для ошибок

Добавить кнопку/подсказку “Установить приложение” (если доступно)

В режиме offline:

можно открыть ранее просмотренные скрипты/темы (хотя бы из localStorage/cache)

новые генерации не запускаются, показывается подсказка

B3) Визуальный стиль: “плоский светлый”

Светлая тема по умолчанию (#FFFFFF фон)

Карточки с лёгкой тенью или тонкой обводкой

Акцентный цвет один (например, синий/индиго), без кислотных

Шрифт системный или Inter

Много воздуха, крупные заголовки

Минимум декоративщины, максимум читабельности

B4) Компоненты UI (обязательные)

Top App Bar: название + кнопка Settings + user menu

Bottom Nav (mobile): Панель / Источники / Темы / Скрипты / Настройки

Карточки: SourceCard, TopicCard, ScriptCard, JobToast

Status chips: Draft/Generating/Ready/Error

Progress bar для jobs

Toast/Alert система

Modal для подтверждений

Skeleton loading на списках

B5) Основные экраны (обязательные маршруты)

/login — простой логин по паролю из .env (admin password)

/panel — дашборд:

кнопка “Обновить темы”

последние темы (top 10)

последние скрипты

статус фоновых задач

/sources — управление источниками

/topics — темы/тренды

/scripts — список скриптов с фильтрами

/script/{id} — главный экран производства

/settings — API ключи, модель, дефолты (duration, preset), лимиты, тест соединения

B6) Экран Script (самый важный)

Должен быть “конструктор-пайплайн”:

Вверху: тема, источник, дата, score

Выбор:

duration: segmented control 30/45/60

preset сценария: dropdown (6 вариантов)

preset озвучки: dropdown (6 вариантов)

язык ru/en

Блоки по этапам (каждый в карточке):

Hook (текст + кнопка regen + edit)

Voice Script (текст + regen + edit)

Storyboard (таблица/список сцен):

Scene #, Visual (b-roll), On-screen text, SFX, Duration hint

кнопка “Скачать storyboard.md”

Voice (TTS):

выбор голоса (если поддерживается), скорость

кнопка Generate

плеер (если есть файл)

Music:

mood/bpm/genre suggestions, ссылки, license note

Export:

кнопка Generate ZIP

ссылка на скачивание

Справа/внизу: панель jobs/логов (последние операции)

C) АРХИТЕКТУРА И СТАБИЛЬНОСТЬ
C1) Никаких “падений сайта”

Любая ошибка генерации = Job.status=error и Script.status=error, но UI живёт.

Ошибка должна показываться человеку понятным текстом: “Нет API ключа” / “Ошибка провайдера” и т.п.

Логи в консоль + краткий error в БД.

C2) Фоновые задачи без Redis

Сделай простую очередь:

Job создаётся при нажатии кнопок

Worker выполняет по одному (или 2) job’а одновременно (лимит)

Можно использовать:

APScheduler loop каждые N секунд проверяет queued jobs

или background task runner внутри FastAPI
Важно: на слабом сервере — ограничения:

не более 1 LLM job одновременно

таймауты на запросы

ретраи 1–2 раза

C3) Конфиги и секреты

.env для секретов

UI Settings сохраняет ключи в БД (или показывает “положи в .env”)

Не светить ключи в логах/страницах

Сделать endpoint “Test provider” в /settings

D) ПРОМПТЫ ДЛЯ LLM (встроить сразу)

Сделай генерации на русском по шаблонам:

D1) Общие правила генерации

Входные данные: topic.title, topic.raw_text, topic.url, duration_sec, style_preset, language.
Выход:

hook: 1–2 строки, цепляюще

voice_text: рассчитано под длительность (примерно):

30 сек: 70–100 слов

45 сек: 110–150 слов

60 сек: 150–200 слов

storyboard: 6–10 сцен, каждая:

sec (пример длительности сцены)

visual (что показываем)

onscreen (короткий текст на экране)

sfx (если нужно)

notes (монтаж/темп)

тон должен соответствовать пресету.

D2) Отличия пресетов (обязательные правила)

Кинематографичный: образность, атмосфера, “кадры”, плавный темп, драматургия

Режиссерский: как постановочный план, чёткие указания по кадрам/движению камеры

Мемный: простые фразы, шутки, интернет-сленг без токсичности, быстрый темп

Трендовый: динамика, актуальные формулировки, призыв к комменту/реакции

Классический: нейтрально, понятно, без сленга, структура “ввод → факты → вывод”

Новостной: максимально фактологично, без домыслов, “сейчас стало известно…”

Если данных недостаточно — явно пометь: “не хватает источника/подробностей”, но всё равно выдай рабочий текст без выдумывания фактов.

E) ЭТАПЫ РАЗРАБОТКИ (обязательно соблюсти)
Этап 1 (MVP fallback)

Каркас + БД + маршруты + UI

Sources/Topics/Scripts/Script view

Генерации только fallback (шаблоны)

Экспорт ZIP работает

Этап 2 (Jobs)

Очередь jobs, прогресс, статусы

Кнопки запускают jobs

Стабильность, без падений

Этап 3 (OpenRouter LLM)

Подключение OpenRouter

Параметры: model, temperature, max_tokens

Нормальные промпты под пресеты + длительность

Этап 4 (TTS optional)

Подключить один провайдер

В fallback — voice.txt

Этап 5 (Music)

Suggestions JSON + ссылки

(опционально) интеграция библиотек

Этап 6 (Улучшение трендов)

RSSHub/Telegram feeds

scoring улучшить

фильтры/поиск

F) ЧТО НУЖНО ВЫДАТЬ В РЕЗУЛЬТАТЕ (обязательно)

Полный проект в реплите со структурой папок

Инструкция: как запустить (Run)

Инструкция: как настроить .env / settings

Демо-данные:

один Source

одна Topic

один Script

После запуска я должен сразу:

открыть /panel

увидеть темы

создать Script

нажать “Сгенерировать всё” (fallback)

скачать ZIP

G) ДОПОЛНИТЕЛЬНЫЕ ТЕХНИЧЕСКИЕ ПОДРОБНОСТИ (важно)

Не используй сложные shell-скрипты для патчинга. Всё должно быть в коде.

Аккуратно с путями и шаблонами (чтобы не ломались templates).

Никаких “404 на /login” — все роуты должны быть реально настроены.

Добавь health endpoint /health.

Добавь endpoint /api/docs (или /docs) для проверки API.

Сделай ограничения на размер текста (manual input) и обработку ошибок.

Начинай создавать проект прямо сейчас, с Этапа 1, но сразу закладывай архитектуру провайдеров и jobs.